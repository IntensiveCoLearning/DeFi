---
timezone: Pacific/Auckland
---

> 请在上边的 timezone 添加你的当地时区，这会有助于你的打卡状态的自动化更新，如果没有添加，默认为北京时间 UTC+8 时区
> 时区请参考以下列表，请移除 # 以后的内容

timezone: Pacific/Honolulu # 夏威夷-阿留申标准时间 (UTC-10)

timezone: America/Anchorage # 阿拉斯加标准时间 (UTC-9)

timezone: America/Los_Angeles # 太平洋标准时间 (UTC-8)

timezone: America/Denver # 山地标准时间 (UTC-7)

timezone: America/Chicago # 中部标准时间 (UTC-6)

timezone: America/New_York # 东部标准时间 (UTC-5)

timezone: America/Halifax # 大西洋标准时间 (UTC-4)

timezone: America/St_Johns # 纽芬兰标准时间 (UTC-3:30)

timezone: America/Sao_Paulo # 巴西利亚时间 (UTC-3)

timezone: Atlantic/Azores # 亚速尔群岛时间 (UTC-1)

timezone: Europe/London # 格林威治标准时间 (UTC+0)

timezone: Europe/Berlin # 中欧标准时间 (UTC+1)

timezone: Europe/Helsinki # 东欧标准时间 (UTC+2)

timezone: Europe/Moscow # 莫斯科标准时间 (UTC+3)

timezone: Asia/Dubai # 海湾标准时间 (UTC+4)

timezone: Asia/Kolkata # 印度标准时间 (UTC+5:30)

timezone: Asia/Dhaka # 孟加拉国标准时间 (UTC+6)

timezone: Asia/Bangkok # 中南半岛时间 (UTC+7)

timezone: Asia/Shanghai # 中国标准时间 (UTC+8)

timezone: Asia/Tokyo # 日本标准时间 (UTC+9)

timezone: Australia/Sydney # 澳大利亚东部标准时间 (UTC+10)

timezone: Pacific/Auckland # 新西兰标准时间 (UTC+12)

---

# {Naomi}

1. DeFi Lover
2. 你认为你会完成本次残酷学习吗？yes

## Notes

<!-- Content_START -->

### 2024.08.19

[笔记内容](https://banklessdao.substack.com/p/the-stablecoin-edition-defi-download

稳定币比传统汇款方式更快 手续费更低

交易对手风险：交易一方违约的风险。

风险溢价：如果一方违约风险较高，交易中通常会附加一定的[溢价](https://www.investopedia.com/terms/p/premium.asp)以补偿另一方。由于交易对手风险而增加的溢价称为风险溢价。

2014 年发行的稳定币:

Nunbits依靠套利和博弈论来维持其与美元的挂钩.它根据复杂的算法过程创建和销毁新代币以保持价格稳定。

Tether 代币（USDT）都由公司金库中的现实世界资产支持.

### **链下抵押稳定币**

这些稳定币由传统资产（如证券和商品）支持，需要托管人保管。链下抵押是最高效的稳定币之一

我们有不同类别的链下抵押稳定币；

1. 法定货币抵押稳定币

每单位法定货币应创建一美元的稳定币。这意味着稳定币的储备中应有同等比例的法定货币，

2. 商品抵押稳定币

这些稳定币由其他类型的可互换资产（如黄金、贵金属、石油和房地产）支持.最常见的大宗商品稳定币例子之一是 PAX Gold，

**稳定币的风险**

- 稳定币受其所挂钩资产的健康状况影响。
- 当涉及链下抵押资产时，总是存在交易对手风险.用户应该注意透明度报告。

### **加密抵押稳定币**

加密抵押稳定币是由链上加密资产支持的稳定币。

目前最受欢迎的加密抵押稳定币是 DAI，它是由将 ETH 和 USDC 等资产作为抵押品存入 Maker 协议的用户铸造的。加密抵押稳定币需要**超额抵押。eg:**要铸造 100 美元的 DAI，您需要存入价值超过 170 美元的 ETH 作为抵押品。因此资本效率低下

### **算法稳定币**

算法稳定币最常采用的机制是铸币税。

**铸币税算法稳定币**

铸币税是货币面值与生产成本之间的差额。eg:LUNA（Terra 区块链的原生代币，类似于 ETH）和 UST（Terra 区块链的原生稳定币）。

每枚 UST 都可以通过销毁价值 1 美元的 LUNA 来铸造。如果 UST 失去与美元的挂钩，价值超过 1 美元，那么持有 LUNA 的人就会受到激励，销毁 LUNA 来铸造 UST，然后出售该 UST 以从铸币税中获利。铸造 1 枚 UST 需要价值 1 美元的 LUNA，而 UST 目前的价值超过 1 美元，因此如果他们在公开市场上出售 UST，他们将获得套利利润。

算法稳定币是三种类型中资本效率最高的稳定币。缺点：高风险，可能会崩盘

在中心化交易所，你可能会说稳定币不是必需的，但在使用区块链时，没有其他方式来代表法定资产。DeFi 用户选择稳定币作为避风港。)

### 2024.08.20
### USDT和Dai的缺点

USDT通过持有现金作为储备抵押品

缺点：非透明发行过程；

DAI：

Maker是DeFi在去中心化"中央银行"的首次尝试。作为一个借贷协议，当抵押品（通常是ETH）被存入Maker金库时，DAI作为借贷需求的副产品被发行。

金库是超额抵押的。这有助于防范黑天鹅事件，即抵押资产的价值大幅下降。

缺点：过度抵押限制了资本效率

### 解决稳定币的问题

平衡DeFi的去中心化精神与创造一种能够可靠地维持其挂钩的货币。

### **算法型稳定币和稳定资产**

### 算法稳定资产

把算法稳定币想象成一个自动化的美联储。大多数算法稳定币与美元挂钩，但有些不是，有些甚至是浮动挂钩，从而创造了一种新的资产类型，我们将其归类为算法稳定资产。算法稳定资产可以被视为另一种形式的抵押品，而不是会计单位。

稳定币分类：将UST和sUSD归类为算法稳定币，因为它是由其原生代币支持的，与DAI不同，后者是由ETH和USDC等第三方资产支持的。这是一个关键的标准，因为依靠自身发行的资产作为抵押品会产生**递归**的价值，

算法稳定币可以进一步细分为不同的类别--主要的子类别是：rebase（弹性）和seigniorage（铸币税）模式。

### **弹性模式（rebase）**

弹性模式通过**改变稳定币的全部供应量**来控制价格。根据**稳定币的价格是高于还是低于预定的挂钩价格**，协议将在一个固定的时期内**自动增加或减少每个持有人钱包中代币的供应量**。

### 2024.8.21

### **铸币税模式**

如果价格高于挂钩，新的代币就会被铸造，并分配给提供流动性或有代币抵押的参与者。如果价格低于挂钩，代币将停止铸造，并引入机制以减少供应。用户可以购买燃烧相关代币的优惠券，将其从供应中销毁。这些优惠券在未来可以被兑换成更多的代币。

这种模式的三个基本迭代：

1. ESD是一种单币抵押模式。优惠券只能持续30天，这意味着如果系统保持在收缩阶段超过30天，优惠券购买者有可能一无所获。
2. Basis Cash是一种双代币征税模式。算法稳定币（BAC）+**股份代币（BAS）**。协议进入收缩阶段，基准债券（类似于ESD优惠券）可供购买，价格为（BAC）^2。
3. Frax 其稳定币（FRAX）由两种类型的抵押品支持--由法币支持的集中式稳定币（USDC）和其原生股票代币Frax Share（FXS）。Frax采取的是**零散的抵押方式**。Frax有一个可调整的**抵押品比率**。

USDC是由一个中心化的实体。

FEI协议：与Frax非常相似，Fei使用了部分抵押系统，但纯粹由ETH支持。Fei没有借用抵押品，而是引入了一种被称为协议控制价值（PCV）的机制。当FEI的价格高于1美元时，该协议允许用户使用ETH，以优惠的价格（类似于FRAX）直接从系统中铸造新的FEI。当FEI的价格低于1美元时，该协议向FEI卖家征税（其税收随后被烧毁并从供应中移除），并向买家授予额外的FEI。

**Reflexer** RAI的预期目的是成为稳定的抵押品。RAI使用基于ETH的超额抵押模式，并有一个浮动挂钩，最初被设定为3.14美元。

**Float Protocol** Float与FRAX颇为相似，它采用的是两个代币的seigniorage模式，并由ETH进行部分抵押。但是Float的原生资产（FLOAT）有一个浮动的利率，并且其初始挂钩价格为1.61美元。Float的股份代币（BANK）也作为治理代币来支持FLOAT价格。Float使用**荷兰式拍卖**来销售FLOAT，价格以最高价的方式列出，并向下递减至最低（保留）价。

**新的算法稳定币和稳定资产将如何发展**

重点应该放在这些资产是否能保持稳定的价格上。主要考虑：

1. **抵押** 押物优先于资本效率。Float和Fei都让市场力量决定理想的抵押品比例。
2. **交易者的激励/惩罚措施** 
    
    交易者的激励/惩罚措施 较新的协议正在纳入"负强化"战术。每当FEI的价格低于挂钩价格时，Fei就会用交易税来惩罚卖家。

https://docs.makerdao.com/

Dai 保险库：

- 通过锁定加密资产作为抵押借入 Dai
- 偿还 Dai 费用以取回抵押品
- 安全、超额抵押的

**类似于抵押贷款**

● 银行通过“锁定”所有权向你提供贷款 ● 偿还债务以“释放”银行对房屋的所有权

清算：

1. 如果抵押品价值(以美元计)过低，保险库将 自动清算
2. 部分抵押品由协议拍卖，用于偿还未偿还债务+罚 款
3. 随后，协议会销毁 Dai，以减少其供应量 保险库所有者收到剩余的抵押品

MKR持有者：监控、参与并投票表决 Maker 协议的升级/变更

系统防线：**在任何时候，系统的抵押品价值都必须高于 Dai 供应的价值。**

维持这道防线的机制：

1. **供给与需求**
2.  **清算**
3. **MKR 铸造/销毁**
4. 紧急关闭


### 2024.08.22
接上文：
## 智能合约模块

**清算比率**-每个保险库的抵押品价值与债务的最低比率(例如 150%)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a6ca9822-e902-41f9-90d9-747f9ae75db0/e173baca-e857-4e9c-ba55-7692f2f56e5b/image.png)

核心模块Core：Vat  Cat  Spotter

核心模块包含Maker协议的状态 和 核心机制

- Vat Maker协议唯一信任的来源
    
    **Vat 包含 Maker 协议的基本元素**:
    
    - 数据库  ⻛险参数以及 Dai、Sin、抵押品和债务余额
    - 会计系统
    - 保险库管理。锁定抵押品和债务头寸的调整
    - 保险库可互换性  转移、拆分和合并保险库的能力
- Cat
- Spotter

## 抵押品模块

组件：

- Join Join adapter是一个智能合约 用来存储解锁的资产（gem💎）
- Flipper 卖出gem来购买和燃烧Dai 会提高抵押率

## 系统稳定性模块

当支持 Dai 的抵押品价值跌破清算水平时，系统的稳定性就会受到威胁。系统稳定器模块为 Keepers 设置了激励 机制(激励外部参与者)介入，将系统恢复到安全状态并赚取利润。

组件：

- Vow发誓

当Maker协议获得系统债务和系统盈余 时，它会偏离平衡。Vow 包含启动债务和盈余拍卖的业务逻辑，从而纠正系统的货币失衡。

- Flopper

弥补系统赤字。**尽快**筹集与坏账金额相当的 Dai

- Flapper

盈余拍卖的目的是从 Vow 中释放 Dai 盈余。它出售固定数量的 Dai 来购买并销毁一定数量的 MKR。


### RWA

Real-World Assets (现实世界资产)即传统的、实物形式的资产（如房地产、债券、股票等），而非数字资产或虚拟资产。

什么是信贷资产？

**信贷资产**（Credit Assets）指的是金融机构或其他贷款方向借款人提供的贷款和融资，这些资产代表借款人需要按约定偿还的本金和利息。信贷资产是贷款方持有的财务权利，通常包括各种类型的贷款，如抵押贷款（Mortgage Loan）、信用贷款（Personal Loan）、商业贷款（Business Loan）等。

**New Silver** 是 MakerDAO 的第一个 RWA（现实世界资产）项目，其底层资产是由 New Silver 发起的房贷资产，即抵押贷款。这意味着 New Silver 作为贷款人，向借款人提供抵押贷款，借款人以房产作为抵押品，承诺按期偿还贷款。

## **MakerDAO——New Silver**

## 运作流程

1. **New Silver**：在这个场景中，New Silver 是一个贷款发起人或金融服务提供商。New Silver 向传统借款人（例如房主）提供抵押贷款。这些房主用他们的房产作为抵押，从 New Silver 获得资金。此时，房主是向 New Silver 借款的借款人。
2. **房产抵押贷款**：房主（个人或企业）将房产抵押给 New Silver，并从 New Silver 获得贷款（现金）。这些贷款被视为信贷资产。
3. **代币化资产**：New Silver 然后将这些房产抵押贷款的资产（即他们从房主那里获得的贷款债权）代币化，通过 Centrifuge 等平台将这些贷款资产转换为可在区块链上交易的代币。
4. **MakerDAO 参与**：New Silver 作为贷款发起人，利用这些代币化的信贷资产（房产抵押贷款）作为抵押品，存入 MakerDAO 的协议中。通过抵押这些代币化资产，New Silver 能够生成 Dai 稳定币。
5. **Dai 的生成**：New Silver 不是向传统借款人发放的贷款，而是通过抵押他们代币化的信贷资产来生成 Dai。这些 Dai 可能用于进一步的投资、支付给贷款人或其他用途。

### 总结：

- **房主** 是最初的借款人，他们将房产抵押给 New Silver 以获得贷款。
- **New Silver** 将这些抵押贷款代币化，并作为抵押品存入 MakerDAO 系统，从而生成 Dai。
- **New Silver** 通过这一过程获得 Dai，但 New Silver 自己不是 MakerDAO 的借款人，而是抵押品提供者。

所以，最终生成 Dai 并从 MakerDAO 获得流动性的是 New Silver，而不是直接的房主。

### **MakerDAO——BlockTower Credit（信贷资产 RWA）**

### 具体流程如下：

1. **代币化信贷资产**：
    - BlockTower Credit 将其持有的信贷资产（如房产抵押贷款或其他贷款）通过区块链平台（例如 Centrifuge）进行代币化。
    - 代币化后，这些信贷资产被转换为数字代币，每个代币代表这些资产的一部分权益。
2. **出售代币给投资者**：
    - 这些代币被提供给投资者，投资者通过购买代币，向 BlockTower Credit 提供资金。
    - 投资者购买代币后，实际上持有了这些信贷资产的一部分，期待从中获得收益（如利息或其他收益）。
3. **获得资金**：
    - BlockTower Credit 通过出售这些代币获得了资金，这些资金来自投资者。
    - 这些资金不再被锁定在特定的信贷资产上，而是可以自由使用。
4. **再投资或业务扩展**：
    - BlockTower Credit 可以将这些资金用于其他形式的投资，如购买新的信贷资产、进行业务扩展、进入新的市场、或者进行其他类型的投资活动。
    - 通过这种方式，BlockTower Credit 能够在不必等待现有信贷资产到期的情况下，迅速获得流动性和资金支持。

### 2024.08.23
### 资产上链逻辑

1. Borrower 拟将其现实世界资产（如房产贷款、应收账款、发票等）进行融资；
2. 资产发起人（与 Borrower 有业务往来，并承担部分承销的职能）为 Borrower 的现实世界资产设立独立特殊目的公司 SPV（SPV 作为独立融资主体，起到与资产发起人破产隔离的效用）；
3. 资产发起人发起并验证 SPV 中 Borrower 的现实世界资产，并在链上铸造一个与现实世界资产状况相关的 NFT；
4. Borrower 与 SPV 签订融资协议，并将 NFT 抵押在 Centrifuge 资产池中，用以连接 DeFi 的流动性；
5. SPV 仅仅作为一个 pass through 的融资工具，其业务范围被严格地限定，通过 SPV Operating Agreement 进行约定；
6. Centrifuge 资产池为 SPV 提供如 DAI 等的稳定币，通过 SPV 出金转账到 Borrower 的账户；
7. 整个交易的资金流转仅仅涉及 Borrower、SPV、Centrifuge 资产池（连接 DeFi 流动性）；
8. 最终 Borrower 根据融资协议向 SPV 还本付息，并通过 SPV 入金归还 Centrifuge 资产池。待还款结束后，Centrifuge 资产池将解锁 NFT，并返还给资产发起人，由其销毁。

MakerDAO是去中心化金融(DeFi)项目，以加密货币作为抵押品，稳定币DAI与美元挂钩。其社区通过去中心化自治组织(DAO)管理代币。用户将加密货币以一定的强制平仓比率锁定在Maker收益池中，以此来生成DAI。例如，125%的强制平仓比率要求每1美元的DAI背后抵押了价值1.25美元的加密货币

**强制平仓：强制平仓是指将资产非自愿地转换为现金或现金等价物**

eg:我用价值50美元的BTC作为抵押，得到450 美元借款，比特币价格下跌 10%，那么我的抵押品的价值就下跌了，为了保护贷方的资本，资金的贷方就强制清算仓位，将我50美元的抵押卖出去了。

**抵押债仓（CDP：Collateralized Debt Position）（2019年改名为Vault)**

CDP将设置*强制平仓比率*，例如，1.5x，这意味着您需要提供150美元的以太坊，换取100美元的DAI

## **Centrifuge 结构化产品**

Centrifuge 资产池的结构化产品提供两种 ERC20 代币：DROP 和 TIN。

- DROP 代币是优先级别产品（Senior Tranche）.低风险 低回报
- TIN 代币是劣后级别（Junior），高风险高回报

不管哪种产品，损失一旦发生，损失顺序为劣后级-夹层级-优先级。收益反之。

 投资人可以选择用 DAI 等稳定币进行购买 DROP 或 TIN 代币；

## **Centrifuge的**Prime 服务

1. 给DAO一个法律包装
2. Centrifuge 协议专门设立Anemoy LTF 基金，这个基金持有美债，协议会将美债转换为 ERC-20 类型的代币
3. Aave 金库会买美债资产转化成的ERC-20代币
4. Centrifuge 资产池根据协议规则，将 Aave 金库投入的资产（稳定币）分配给 Anemoy LTF 基金。这包括将资金直接投资到美国国债等资产中。
5. Anemoy LTF 基金通过其管理团队负责管理这些资产，包括购买、持有和出售美国国债。
6. Anemoy LTF 基金的投资和收益数据会通过区块链技术进行记录和追踪，确保透明度和可追溯性。

### 资产方

实体资产的所有者

### 资本方

代表了提供资金或流动性的一方。

### 基于ETH 质押的 Layer2——Blast

- **ETH 质押到 Lido**：
    - 用户将他们的 ETH 质押到 Lido 网络上，Lido 提供的是一个以太坊的去中心化质押服务。质押的 ETH 将会被用于生成 stETH（staked ETH），这是一种与 ETH 1:1 锚定的稳定币，代表质押 ETH 的权益。
- **稳定币购买美国国债**：
    - Blast 可能会利用用户质押后生成的 stETH（或者直接使用 ETH 质押产生的 stETH）兑换成稳定币（如 USDC 或其他稳定币），然后将这些稳定币用于购买美国国债。
- **收益发放**：
    - Blast 将通过购买美国国债所获得的收益，按比例分配给质押者。这些收益可能以稳定币的形式发放给用户，作为他们存入资产的回报。
### 2024.08.24

## 智能合约模块

**清算比率**-每个保险库的抵押品价值与债务的最低比率(例如 150%)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a6ca9822-e902-41f9-90d9-747f9ae75db0/e173baca-e857-4e9c-ba55-7692f2f56e5b/image.png)

核心模块Core：Vat  Cat  Spotter

核心模块包含Maker协议的状态 和 核心机制

### 1. Vat  Maker协议唯一信任的来源

**Vat 包含 Maker 协议的基本元素**:

- 数据库  ⻛险参数以及 Dai、Sin、抵押品和债务余额
- 会计系统
- 保险库管理。锁定抵押品和债务头寸的调整
- 保险库可互换性  转移、拆分和合并保险库的能力

### 2. Cat

**清算机制1.0（Cat/英式拍卖系统）**

1. 如果抵押品价值(以美元计)过低，Keepers 清算人就可以向合约发送请求强平这些抵押不足的仓位，从而触发清算程序
2. 部分抵押品由协议拍卖，用于偿还未偿还债务+稳定费+罚款。清算人能够使用 DAI 出价参与拍卖这些抵押品，存在套利的空间。 
3. 随后，协议会销毁 Dai，以减少其供应量 保险库所有者收到剩余的抵押品

**清算机制2.0（Dog/荷兰式拍卖系统）**

荷兰式拍卖采用的是减价拍卖机制。这种拍卖方式在 Maker 协议中是如何运作的，可以通过以下几个步骤来解释：

1.  **初始起拍价设定**

当某个 Vault（抵押债仓）中的抵押品价值不足以支持所借出的 DAI 时，系统会触发清算机制。清算机制启动后，系统会为要拍卖的抵押品设定一个初始的起拍价。这个价格通常会高于市场价格，以确保系统在开始拍卖时能够尝试获取最高的价值。

1.  **价格随时间递减**

在荷兰式拍卖中，价格从初始起拍价开始，随着时间的推移，价格会逐渐下降。这种价格下降是预设好的，按照一定的时间-价格曲线进行。例如，每过一段时间，价格就会降低一定的比例或金额。

1. **竞拍者的参与**

当价格下降到某个竞拍者认为合适的水平时，他们可以选择出价购买这些抵押品。一旦有人出价，拍卖立即结束，并按照出价成交。这意味着竞拍者越早参与，获得抵押品的价格越高；如果愿意等待，可能会以更低的价格获得抵押品，但也面临被其他竞拍者抢先的风险。

1. **成交与清算**

当拍卖成交后，竞拍者支付的金额（通常为 DAI）会用于偿还该 Vault 的债务，剩余的抵押品则交付给竞拍者。如果拍卖成功清算了足够的债务，并且仍有剩余抵押品，这些剩余品将返回给原来的 Vault 拥有者。

1. **参数设置**

时间-价格曲线的具体参数由 Maker 社区设定，包括：

- 初始起拍价
- 价格下降的速度
- 价格下降的幅度

### 3. Spotter

选节点-Medianizer 合约收到节点发出的新的价格就更新存储并发送给喂价安全模块（OSM合约）- Spotter读取，Vault就可以获得抵押品的价格

Spotter 合约的主要功能：对来自预言机的价格做分类

Spotter 合约为不同的抵押品类型（collateral types）提供了一个接口，用于从预言机模块中提取相应的市场价格。

**喂价机制**

Maker 协议需要获得 Vault 中抵押资产价格的实时信息，以便知道何时触发清算。

1. **喂价延迟**
    
    为了防止攻击者大部分控制喂价机的情况。Maker 协议使用了 OSM 来获取价格信息，而非直接使用预言机。OSM 架设在喂价机节点和 Maker 协议之间，是喂价节点和 Maker 协议之间的防御层，将价格更新延迟一个小时，提供了一个缓冲期，使得在价格数据被利用之前，有足够的时间发现并应对潜在的操纵行为。
    
2. 紧急关停

## 抵押品模块

组件：

- Join Join adapter是一个智能合约 用来存储解锁的资产（gem💎）
- Flipper 卖出gem来购买和燃烧Dai 会提高抵押率

## 系统稳定性模块（**拍卖机制）**

当支持 Dai 的抵押品价值跌破清算水平时，系统的稳定性就会受到威胁。系统稳定器模块为 Keepers 设置了激励 机制(激励外部参与者)介入，将系统恢复到安全状态并赚取利润。

组件：

### Vow发誓

负责管理和调度系统的盈余与亏损。可以调用Flopper 模块（债务拍卖）和 Flapper 模块（盈余拍卖）

**管理系统的盈余和亏损**:

- **盈余**：当 Maker 协议通过收取稳定费（Stability Fee）和清算罚款等途径获得收入时，这些资金会被存入 Vow 模块。盈余达到一定水平后，Vow 会触发盈余拍卖（Flapper）机制，使用盈余的 DAI 来回购并销毁 MKR 代币。
- **亏损**：当系统产生亏损（例如清算不足），并且 Maker Buffer 无法覆盖这些亏损时，Vow 模块会记录这些亏损。为了弥补亏损，Vow 会触发债务拍卖（Flopper）机制，增发并拍卖 MKR 代币以筹集 DAI。

### Flopper

**Flopper** 模块负责债务拍卖。**尽快**筹集与坏账金额相当的 Dai。

Maker 协议中的拍卖机制包括了**抵押品拍卖（Collateral Auction）、盈余拍卖（Surplus Auction）和债务拍卖（Debt Auction）**

Maker赚钱，钱会被存入 Vow 模块，钱会首先分配给缓冲金，缓冲金用于偿还抵押品拍卖不足产生的债务：
清算发生-抵押品拍卖不足清偿-缓冲金补上，缓冲金还是不够-债务拍卖：增发MKR代币：

债务拍卖中，Maker 协议会增发新的 MKR 代币，并将这些 MKR 代币出售给竞拍者，以换取 DAI。这些 DAI 被用于偿还系统的债务。

- **拍卖过程**：债务拍卖通过竞标机制进行。参与者出价购买新发行的 MKR 代币，通常他们会以略低于市场价的折扣购买。这样做的目的是迅速筹集到所需的 DAI。
- **消化亏损**：通过卖出增发的 MKR，系统获得的 DAI 用于填补拍卖不足部分的债务，从而维持 DAI 的稳定性和 Maker 系统的整体健康。

### Flapper

盈余拍卖的目的是从 Vow 中释放 Dai 盈余。它出售固定数量的 Dai 来购买并销毁一定数量的 MKR。

## 紧急关停

紧急关停机制启动后会经历三个阶段：

1. Maker协议关闭 用户无法创建和操作金库，喂价机制冻结。如果一个金库有超额抵押，金库所有者可以在这一步取回抵押品中超过债务部分的那一部分。
2. 开始拍卖 对系统所有的抵押品变现，然后按Dai持有者持有的Dai数量分配给他们。确保了即使在系统关闭的情况下，每个 DAI 持有者都能按比例得到他们应得的资产价值，从而保护了参与者的权益。
3. 赎回 DAI 持有者可以使用他们手中的 DAI 兑换抵押品。这意味着每个 DAI 持有者可以按照一个固定的兑换比例（这个比例通常是与拍卖结果相关的）来赎回对应的抵押品。

## **锚定稳定模块（PSM）**

无论市场上USDC和DAI的汇率如何改变，用户都可以按照固定汇率转换U和DAI。

- 用户可以以 1 USDC 换取 1 DAI，支付 0.1% 的交易费用。
- 用户也可以以 1 DAI 换回 1 USDC，不论市场上的 DAI 价格是高于还是低于 1 美元。

这种机制确保了 DAI 的价格稳定在 1 美元左右，因为用户可以利用这个固定汇率在市场上套利，从而平抑价格波动。这也是为什么该模块被称为“锚定稳定模块”，因为它通过提供固定汇率的兑换渠道，为 DAI 提供了价格稳定的保障。

### 刚性兑付

在金融市场或投资产品中，发行方承诺在特定情况下无论投资标的物的市场价格如何波动，都按固定的价格或者收益进行兑付

### 闪电铸造

套利者从Maker无抵押闪电贷了10个D AI，然后又把这些Dai以更高的价格在另外一个平台卖出，得到一笔钱，然后用这笔钱在另外一个平台中买入较低价格的Dai并偿还Maker，最后套利者会得到价差带来的利润

### 2024.08.25
TO be continue in Monday

### 2024.08.26

## 测试网实操

水龙头：[Sepolia Faucet - Get Testnet Tokens (chain.link)](https://faucets.chain.link/sepolia)

[Ethereum Sepolia Faucet (google.com)](https://cloud.google.com/application/web3/faucet/ethereum/sepolia)

**健康因子Health factor**：

- **定义**：健康因子是评估借款人在 Maker Protocol 中借贷位置安全性的指标。它计算为抵押品总价值与未偿债务加缓冲（通常为10-20%）的比率。
    
    健康因子 = （抵押品总价值 * 清算比率） / （总债务 + 稳定费）
    

**解释**：健康因子超过1表示抵押品价值足以覆盖债务和缓冲，减少被清算的风险。健康因子低于1表示抵押品价值不足，增加了被清算的风险。健康因子越高越好

**借款能力Borrowing power used**：

- **定义**：借款能力指的是基于借款人存入的抵押品价值和当前 Maker Protocol 参数，用户最多可以借取的 Dai（或稳定币）金额。

**借款能力**（Borrowing Power）= （抵押品总价值 * 清算比率） - 已借款金额

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a6ca9822-e902-41f9-90d9-747f9ae75db0/7ef2cf70-ca63-45b9-a876-7286218c5802/image.png)

# Web3支付
https://mp.weixin.qq.com/s/gzr9q9kM3j-R0ec7sCb3NQ

[ChatGPT (sharedchat.fun)](https://chat.sharedchat.fun/c/6493afd9-3339-4305-8212-40ad9b8893a7)

与传统支付相比优点：

1. 即时结算
2. 降低成本
3. 公开透明
4. 全球可触达

例子：
PayPal在 Solana 高性能区块链上线 PYUSD

### 代币化

将传统有形资产（如房地产、农业或矿业商品、模拟艺术品）、金融资产（股票、债券）或无形资产（如数字艺术和其他知识产权）记录到区块链可编程平台上的过程

 **代币化的优势**

**提高资本效率**

**回购交易（Repo）** 是一种短期借贷协议，借款方将证券（如政府债券）卖给贷款方，并同意在未来某个日期以略高的价格买回这些证券。传统的回购交易结算通常需要两个工作日（T+2）才能完成，而代币化后的回购交易可以在几分钟内完成，即所谓的T+0结算时间。

数字货币，都是货币被代币化之后的一种表现形式。**代表的是基于区块链的，新的货币流通方式。**

### **代币化存款**

代币化存款是商业银行存款的数字凭证

**稳定币的可编程性**

由于 USDC 在智能合约区块链上使用开源代码，因此任何人都可以轻松地对其进行编程，以适应简单的“如果/那么”业务条件。例如，Cirlce 与一家为农民提供农业种子保险的肯尼亚公司进行了交谈，该公司将当地天气数据纳入智能合约，以使用 USDC 自动支付保险费。

### PayFi

应用场景：

1. 支付

用户的借贷收益用于支付。类似于余额宝

你理解得很对，这个例子很像将用户的借贷收益用于支付的过程。以下是详细解析：

1. **DeFi 借贷协议**：PayFi 支付服务商需要与去中心化金融（DeFi）借贷协议对接。DeFi 借贷协议是指在区块链上运作的去中心化平台，用户可以将资金存入这些平台，作为流动性提供者（LP），从中赚取利息收益。
2. **用户 Kevin 作为流动性提供者**：Kevin 将资金存入 DeFi 借贷协议，成为流动性提供者，这样他可以从协议中赚取利息或收益。
3. **授权使用借贷收益**：PayFi 支付服务商获得 Kevin 的授权，可以使用 Kevin 在 DeFi 借贷协议中产生的收益来支付实际购买的费用，比如咖啡的费用。
4. **支付过程**：在这个场景中，Kevin 购买一杯 5 美金的咖啡。PayFi 利用 Kevin 的借贷收益来支付这笔费用。假设借贷收益足够支付 5 美金的咖啡费用，并且 PayFi 还从中提取了 0.5 美金作为服务费。最终，Kevin 实际上没有动用自己的现金，而是用收益来完成支付。
5. **结算给商家**：PayFi 将获得的 DeFi 收益转换成法币，与商家进行结算。这样，商家得到的是法币，而用户则通过收益完成了支付，间接地避免了直接用现金支付的过程。

**类似于余额宝**：你的比喻很贴切。余额宝是一个将资金投资于货币市场基金的产品，用户可以通过余额宝的收益来实现类似的功能。余额宝中的收益相当于 DeFi 借贷协议中的收益，用户可以使用这些收益来支付某些费用，而实际的支付是在其收益基础上完成的。

总的来说，这种模式让用户能够用借贷或投资收益来支付实际支出，而不是直接动用自己的现金。

1. 抵押借贷：Bob 提供ETH 作为抵押品在 DeFi 平台上借稳定币，DeFi 协议可以直接调用 Fiat24 银行协议来形成 USD 法币的出借；
2. 投资/质押生息：Alice 提供 ETH 去做质押生息，DeFi 协议可以直接调用 Fiat24 银行协议来将生息资产通过法币的形式发放，

### Fiat Layer Banking Protocol

“Fiat Layer Banking Protocol”（法币层银行协议）是一个在去中心化金融（DeFi）生态系统中引入和处理法币业务逻辑的协议。这个协议的目的是将传统法币（如美元、欧元）与去中心化金融应用结合起来，使得在 DeFi 环境中能够处理和操作法币资产。

# 借贷协议
https://banklessdao.substack.com/p/the-lending-edition-defi-download

### 定向押注

是指投资者根据自己对市场走势的判断，选择增加或减少对某种资产的敞口，以期在市场价格上涨或下跌时获得收益。

**正面敞口**（看涨）：

- 用户将价值 10,000 美元的 ETH 存入借贷协议作为抵押品。
- 用户借出 5,000 美元的稳定币（如 USDT 或 USDC）。
- 用户用这 5,000 美元购买更多的 ETH。

通过这个操作，用户将自己对 ETH 的敞口增加到 15,000 美元（10,000 美元原始持仓 + 5,000 美元借来的资金），从而在 ETH 价格上涨时获得更大的收益。

**负面敞口**（看跌）：减少对某种资产的敞口，或者通过做空来获利。用户预期某资产价格会下跌，通过借入该资产并卖出，希望在未来以更低的价格买回，从而获利。

**例子**：

- 用户向借贷协议存入 10,000 美元的稳定币作为抵押品。
- 用户借入价值 5,000 美元的 ETH。
- 用户立刻以 5,000 美元的价格卖出借来的 ETH。
- 此时，用户手中持有 5,000 美元的稳定币（通过卖出 ETH 获得），但用户还欠借贷协议价值 5,000 美元的 ETH。
- **等待 ETH 价格下跌**：
    - 假设 ETH 价格下跌到 4,000 美元，用户预期的情况发生。
- **回购 ETH 并偿还贷款**：
    - 用户现在可以用手中的 5,000 美元稳定币以每个 4,000 美元的价格买回所需数量的 ETH。
    - 用户用这 4,000 美元买回 ETH 并还给借贷协议。
    
    此时，用户剩下 1,000 美元的稳定币（5,000 美元原本持有的资金减去 4,000 美元买回 ETH 的成本），这就是他们的利润。

### 2024.08.28
### APR （Annual Percentage Rate年利率）

代表存款人在一年内从给定投资中获得的收益（利息）

将产生的收益重新存入本金，以“复合”收益来获得更大的回报

交易会产生 gas 费用,对于小投资者来说，交易费通常会抵消存款产生的收益，因此这种形式的回报更适合更大的投资。

### APY(Annual Percentage Yield)

自动复利，就是会自动存入产生的收益以增加您的投资本金，为了解决APR存在的问题

### 流动性池

池子中每种代币的数量越多，从一种代币到另一种代币的交易中损失的价值量就越小。

**滑点**是指从一种代币到另一种代币的交易中损失的价值量。

假设有一个流动性池，其中有两种代币：ETH 和 USDC。初始时，这个池子里的ETH数量为100个，USDC数量为10,000个。这时，ETH/USDC交易对的价格为1 ETH = 100 USDC。

现在考虑一个交易者想要交易10个ETH为USDC。根据当前的价格，交易者预期可以得到1,000 USDC。然而，由于交易会影响流动性池的价格，这可能导致交易价格上升或下降，即滑点。

[交易完成后，价格会怎么变化](https://www.notion.so/cad71b04d3eb4565bb6f8a9619faf694?pvs=21)

现在，我们再考虑另一个流动性池，其中有四种代币：ETH、USDC、DAI和USDT，每种代币的数量分别为100个ETH、10,000个USDC、10,000个DAI和10,000个USDT。

对比这两个流动性池：

- 在第一个池子中，ETH和USDC的流动性更少，因此交易10个ETH可能会导致价格波动较大，即较高的滑点。
- 在第二个池子中，由于有四种代币提供了更多的流动性，ETH和USDC的比重相对较小，因此交易10个ETH对于整个池子的影响较小。这意味着交易者可以更接近预期的价格，滑点较小。

### 流动性池存在原因

为了取代订单簿

### 订单簿

买家试图以尽可能低的价格购买特定资产，而卖家则试图最大化他们从特定资产中获得的金额。这种模式有一个可以进行交易的开盘和收盘时间，买卖双方必须找到他们愿意接受的价格才能达成交易。

## 自动做市商

AMM 使用户能够自动且无需许可地进行交易，而无需交易所和订单簿

AMM有三种类型：Uniswap、Curve 和 Balancer。

### Curve 的关键特点：

1. Curve 专注于处理价格接近的资产（比如都是和美元挂钩的资产）
2. Curve 使用不同于 Uniswap 的定价曲线。Uniswap 使用的是恒定乘积公式，而 Curve 使用的则是更复杂的公式，
3. Curve 也支持多资产池，允许流动性池包含多达 4 种或更多类似资产

例子：

假设你在 Curve 上有一个稳定币流动性池，包括 USDC、USDT 和 DAI。由于这些资产都是与美元挂钩的稳定币，它们的价值非常接近。Curve 使用其专门的 StableSwap 算法来优化这些资产之间的流动性和交易。

如果你想用 USDC 交换 DAI，由于 Curve 的优化算法，交易过程中产生的滑点会很小。与其他 DEX 相比，Curve 可以提供更接近的预期价格，从而节省交易成本。用1个U就能交换接近1个DAI，而在Uniswap中，1个U就只能更少的DAI，因为滑点更大。

### Balancer

支持多代币流动性池和自定义权重

假设你创建了一个包含 4 种代币的 Balancer 流动性池，权重如下：

- 40% ETH
- 30% DAI
- 20% USDC
- 10% LINK

当有人在这个池子中进行交易时，比如用 ETH 兑换 DAI，Balancer 会使用恒定乘积公式来管理流动性池中的代币。交易者会支付交易费用，这些费用会分配给所有的流动性提供者，按照他们在池中的权重和贡献进行分配。

## 借贷项目

### Maker

• 闪电贷

### AAVE

### Alchemix

Alchemix 提供所谓的**自还贷款**。该平台使用您的抵押品为您赚取收益，并逐步偿还您的债务余额。

### Euler

贷款必须由稳定币、ETH 和 BTC 等大型、信誉良好的资产支持。Eul有*资产的等级列表*

- *隔离层资产需要自己特定的抵押品。*
- *跨层资产可以共享抵押品。代币 ABC 和 XYZ 都可以通过 ETH、DAI 等进行借贷。*
- *Collateral-Tier 可用作抵押品，借入任何层级的任何资产。*

### Notional

Notional 是一个提供固定利率贷款的项目

### 固定利率

无论市场条件或经济环境如何变化，借款人或投资人支付或收到的**利息始终按照事先约定的利率计**算。

固定利率的形成方式有2种：

1. 固定利率贷款

**“稳定”利率**

- 初始利率在借款时确定，并在一定时间内保持不变，但不是永久固定的。
- 如果市场条件发生显著变化，协议可能会触发“重新平衡事件”，导致“稳定”利率调整，以确保协议的偿付能力。

**收益耕作**

用户将他们的加密资产（如稳定币、代币等）提供给去中心化交易所（DEX）或流动性池，这些资产会被用于交易或借贷等操作。用户会得到奖励，并可以将奖励再次投资于流动池，形成耕作循环。

固定利率贷款可以解决这个问题。项目可以借入必要的资产以保持偿付能力（以固定利率）并拥有自己的流动性头寸，而无需承担收益耕作激励的成本，也不必承担流动性提供者离开的风险。

项目可以通过固定利率贷款来以固定利率拥有自己的流动性头寸，无需用于激励用户的成本，所以固定利率的实现可以通过稳定利率

1. 收益再分配
    
    协议可以使用收益资产来创建利率的二级市场。有2种类型：
    
    1. 分割本金和收益
        
        A将100000DAI投资到AAVE，并将该头寸所赚取的利息 (i) 重新打包为独立产品，假设某个用户 B 愿意以 500 DAI 购买该头寸所赚取的利息。卖家 A 从 10,000 DAI 投资中获利 5% 并保留其本金。因此，B 购买了与利息收益相关的产品，因此需要接受利率变化带来的风险，也就是承担该头寸浮动利率的方向性风险，而A因为卖出了该头寸所赚取的利息，得到500DAI，相当于A 创建了固定利率资产的头寸。
        
    2. 结构化产品
        
        结构性产品的基本构成
        
        1. **第一组（X）**：提供固定利率回报的投资。X 投资者承诺获得一个固定的 5% 回报，不管市场利率或资产表现如何。
        2. **第二组（Y）**：提供浮动利率回报的投资。Y 投资者的回报是基于某个基础利率加上额外的浮动部分（通常是基础利率加一个浮动溢价），回报可能会超过 5%，也可能低于5%。
        
        弥补机制
        
        如果回报低于 5%，Y 的资产将用于弥补 X 组的回报差额，就是为了确保X组拥有5%的回报
        

### 浮动利率

浮动利率是指利率会根据市场条件变化而调整

在执行贷款时，贷方和借方各自收到 fCash 余额，后者收到负数。这些余额代表**头寸**，包括利息支付

**头寸**

投资者或交易者在某一金融工具（如股票、外汇、期货等）中的**持仓状况**

- **多头头寸（Long Position）**：表示投资者**买入**某种资产，**期望价格上涨以获利**。这时，投资者的头寸是“多头”。
- **空头头寸（Short Position）**：表示投资者**借入**某种资产并卖出，**期望价格下跌以在未来低价买回资产还给借方**，从中获利。这时，投资者的头寸是“空头”。
- **平头寸（Flat or Square Position）**：表示投资者已经平仓，手中不再持有任何头寸，也就是说既没有多头也没有空头。

**对手方**

在任何交易中，都会有两方或多方参与，这些参与者相互之间就是对手方。

Notional 用户有三种不同类型：贷方、借方和流动性提供者

Notional 中流动性提供者充当贷方和借方的对手方，每次交易时都会收取费用。流动性提供者的风险是无常损失 (IL)。

假设你向一个流动性池中提供了等值的现金和fCash。如果fCash的价格上涨，你在池中的fCash会相应减少，而现金会增加，使得你最终从池中提取的资产总价值低于如果你只是单独持有fCash的情况。这种差额就是无常损失。

### 滑点

滑点（Slippage）是指**交易执行价格与预期价格之间的差异**。

滑点可以分为三种类型：正滑点、无滑点和负滑点。

正滑点：实际执行价格**优于**预期价格的情况。

### 定价曲线

定价曲线的主要作用是确保流动性池中资产之间的**交换价格随着交易量的变化而自动调整**

类型：

1. 恒定乘积Uniswap
2. 恒定和Curve
3. 复杂的

Notional协议通过设计一系列定价曲线来应对流动性池到期时的价格可能剧烈波动

### TVL

TVL是 **Total Value Locked** 的缩写，表示锁定总价值。用来衡量某个协议或平台上所有锁定的加密资产的总价值。

### 隔离池

攻击：攻击者用自己创建的没有价值的代币换取有价值的代币

隔离池的防护机制：

1. 市场隔离 隔离池的设计理念是将不同类型的资产分开，创建多个独立的借贷市场。如果一个池子出现问题，不会影响到其他池子
2. **风险限制**：隔离池允许对不同资产做风险等级管理 对于信誉较差或风险较高的资产，池子创建者可以设置更严格的借贷条件。这意味着即使攻击者试图在某个隔离池内操纵价格，能借出的高价值资产数量也会受到严格限制，

### 杠杆

**杠杆**是指通过借入资金来增加投资头寸的大小

### 去杠杆

用户可以通过偿还借入的资金或减少持有的资产头寸来降低杠杆倍数

### 杠杆率

**杠杆率**是衡量杠杆程度的指标，通常表示为总资金与自有资金的比率。

例如，如果用户的总资产是 2000 美元，自有资金是 1000 美元，则杠杆率为 2（即 2 倍杠杆）。

### 抵押债务头寸（Collateralized Debt Position, CDP）

抵押债务头寸（Collateralized Debt Position, CDP）包括抵押品和借入的资金两个方面。

假设：

- 用户将 10 ETH 作为抵押品。
- 该 10 ETH 的价值为 20,000 DAI（假设 ETH 价格为 2,000 DAI）。
- 用户可以基于这 10 ETH 借入相应的稳定币，例如 10,000 DAI。

**在这个例子中**：

- **抵押品**：10 ETH。
- **借入资金**：10,000 DAI。
- **抵押债务头寸**：用户的 CDP 包含这 10 ETH 的抵押品和这 10,000 DAI 的借款。

### DeFi Saver

一款允许用户跨多种 DeFi 协议管理资产的应用程序

**DeFi Saver** 是一个去中心化金融管理工具，提供以下功能：

- **跨协议管理**：用户可以在多个 DeFi 协议（如 Maker、Compound、Aave）之间管理他们的资产和头寸。
- **自动化**：通过自动化功能，DeFi Saver 可以监控用户的抵押债务头寸（CDP），并根据市场条件自动调整杠杆率，以保持头寸的安全。例如，DeFi Saver 可以在资产价格上涨时增加杠杆（增持），在价格下跌时减少杠杆（偿还）。看涨就可以通过闪电贷增持，放大收益，看跌就减少杠杆
- **闪电贷支持**：自动化的杠杆和去杠杆调整通常通过闪电贷来实现，即在一笔交易中完成借款和偿还，以优化操作的效率。
- **抵押率配置**：用户可以配置最大和最小抵押率，以确保他们的 CDP 保持在安全范围内，防止自动清算。

### 2024.08.29
### Compound

 用户向流动资金池提供资金以赚取利息，而借款人从流动资金池贷款并支付债务利息。Compound降低了贷款/借款的摩擦，允许供应商/借款人直接与利率协议互动，而不需要协商贷款条款（如期限、利率、对手方、抵押品），Compound通过智能合约自动执行这些功能

### Maker

- 超额抵押代币
- 闪电贷
- 铸造DAI
- RWA 缩小与传统金融的差距方面

### AAVE

类似于Compound。开创了新的借贷玩法，如利率转换、抵押品互换和闪电贷款。

**抵押品互换** 

借款人可以将他们的抵押品换成另一种资产。这有助于防止贷款低于最低抵押品比率而面临清算。比如抵押品是ETH，ETH的价格开始下跌，为了避免清算，可以将ETH换成DAI，因为Dai的价值更稳定，即使ETH下跌也不会影响

### **Cream Finance**

Cream是一个Compound的仿盘，主要服务于长尾、小币种的DeFi资产。

“长尾、小币种”是指那些在市场上交易量相对较小、知名度较低的加密货币资产。

**长尾效应**：
小币种加起来所占的市场份额可能比少数热门产品（主流币种）还要大。

在ETH2.0的时候，用户只要把ETH抵押，验证的工作由Cream来做，验证的收益分给用户和Cream，用户可以收到CRETH2,而Cream可以收到8%的收益。

Cream还给白名单伙伴提供无抵押贷款服务

## 上述四个协议的比较（几个指标）

### **借款量**

**这个指标很重要，因为借款人为其贷款支付费用，该费用是协议的收入**

compound：借款人支付的一部分利息将进入其储备金，作为保险，由COMP代币持有人（Compound的治理代币持有人）控制。

储备金：用户贷款的时候要支付利息，这些利息的一部分会直接支付给提供流动性的贷款人，而另一部分则会被系统收集并存入储备金。

储备系数：“储备系数”系数决定了借款人支付的利息中有多少比例将被划入储备金。

### 锁定的总价值（TVL）

### **借贷效率（借款量/TVL）**

### 可变利率

可变利率会根据市场的流动性情况自动调整。如果某个资产的借款需求增加，可变利率会上升；反之，如果需求减少，利率会下降。相对于稳定利率来说，可变利率的初始利率会比较小。适合希望灵活应对市场变化、利用低利率机会的用户

# AAVE
https://chatgpt.com/share/7e49e0c1-89b9-4a37-82f8-94079bf9bff8

https://docs.aave.com/hub

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a6ca9822-e902-41f9-90d9-747f9ae75db0/1beece2b-10c2-4cd6-853d-c907a4cbf713/image.png)

## aToken

aToken表示存款的总价值+累积的利息。

**aToken 的作用：** 当用户存入 1 ETH 到 Aave 市场时，系统会向用户发放 1 aETH。这个 aETH 代表了用户在 Aave 市场中存入的资产，并且它的数量会随着时间的推移而增加。这种增加反映了存款所赚取的利息。

### Portal

实现跨链流动性转移，是一种跨链桥

**资产转移过程：** 当一个用户希望将资产从一个网络转移到另一个网络时，Portal 功能通过以下步骤实现：

- 在源网络上，相关的资产（如 aToken）会被销毁或锁定。
- 在目标网络上，相应的资产会被铸造或解锁，以便用户能够在新的网络上继续使用这些资产。

### BRIDGE_ROLE

只有被赋予了 BRIDGE_ROLE 的地址才能执行涉及跨链流动性转移的操作。

### 2024.08.30

### 效率模式eMode

旨在当抵押品和借入资产的价格相关时最大限度地提高资本效率。

价格相关：价格相关性指的是两个资产的价格变化之间的关系。例如，某些稳定币（如 USDC 和 DAI）价格通常与美元挂钩，因此它们的价格高度相关。

提高资本效率： 由于抵押品和借入资产的价格相关性很高，Aave V3 可以提供更优的借贷条件，例如更高的借款额度或更低的清算阈值。

### 隔离模式

隔离模式允许将新资产列为***隔离资产***，只能用于借入特定的稳定币

孤立借贷比隔离模式更为严格，用户只能使用孤立资产借入相同或者相关的特定资产，和其他资产完全隔离

在隔离模式下，用户还能使用其他资产

风险敞口是**潜在损失风险**

供给和借用上限：供给上限是为了避免无限铸造或价格预言机操纵

### **使用 aTokens 偿还**

如果基础借入资产被锁定在 Aave 流动池中，则允许用户使用*aTokens*偿还。

*示例：* **用户拥有稳定的 DAI 债务，并且还持有 DAI 代币**

基础借入资产：用户从 Aave 协议中实际借出的原始资产。

用户存入的DAI会被转换成aDAI,这代表用户的存款和利息

 用户手里有借入的DAI，同时他还在协议中存储了DAI，但是他存储的DAI由于市场条件等原因被锁定了，不能直接取出来，这时候，他可以用aDAI来偿还他借入的DAI，这样即便存款被锁定，aDAI 仍然能够用于偿还债务，因为 aDAI 表示的是存入 DAI 的权益。

### 多重奖励

V2是流动性挖矿奖励，奖励均以代币stkAave计价，用户在V3版本还是流动性挖矿奖励，只不过奖励除了可以以stkAave计价 还可以以别的奖励计价（如治理代币、稳定币、流动性挖矿代币等）

奖励领取：

V3 还允许用户向另一个帐户以及自己领取奖励

### 2024.08.31
https://chatgpt.com/share/12c58cf7-7ab7-4fc2-b400-152e0f654f76

https://mp.weixin.qq.com/s/0_NedeqDEsK_7npcmREiKg

# 跨链通信协议

## IBC（Inter-Blockchain Communication）

彼此进行无需信任；任何区块链都可以以其标准化形式（链间标准 ICS ）使用 IBC 与其他区块链连接和通信。

IBC 由两层组成：基础级 TAO 层 ( transport, authentication, and ordering ) 和构建在 TAO 之上的 Application 层。

### **中继器**（Relayer）

中继器负责在不同的区块链网络之间传递信息或数据包，确保这些数据能够安全、可靠地从一个链传送到另一个链。

### 中继器的作用

- 信息传递
- 轻客户端验证
    
    为了保证数据正确性，轻客户端是一个运行在接收链上的模块，它可以验证来自其他区块链的信息是否符合预期，而无需信任中继器本身。
    
- 任何人都可以运行一个中继器

中继器是负责传输数据的，而保证信息的正确性是通过轻客户端验证和区块链的共识机制

轻客户端验证：轻客户端通常包含来自发送链的区块头或发送链的共识状态和信息的加密签名等，确保只有合法且有效的信息被接受。

区块链的共识机制：

共识机制的核心目的是确保区块链网络中的所有节点都同意当前区块链的状态。

在PoW（工作量证明）中，节点通过解决复杂的数学难题（即挖矿）来提议新区块；在PoS（权益证明）中，节点通过持有代币的权重来验证新区块。

激励机制：当节点验证了交易并形成区块就可以获得奖励

### 一个交易上链的过程为

节点验证交易-节点打包交易形成区块（在这个过程还要做第2次验证，为了确保交易符合共识机制）-其他节点对该区块做验证

### 跨链通信的流程

1. 当区块链发生某个事件（如交易、状态更新等）时，部署在链上的**智能合约**会被触发。
2. 智能合约输出（代表区块链发生了某个事件，交易、状态更新等）
3. TAO模块被触发并生成输出数据包
4. **轻客户端验证数据包**，确保数据的正确性和合法性（主要在接收链上验证）。
5. **中继器提取数据包**并通过**Connection**和**Channel**将数据包按顺序**发送到接收链**的对应**TAO模块**。
    - **Connection（连接）**: 这是链与链之间的通信管道的抽象表示。它定义了两条区块链之间的基本连接关系，使得它们能够相互识别并建立通信。Connection通常包括连接双方的配置信息，如区块链的标识符、公钥等。
    - **Channel（通道）**: 在已经建立的Connection基础上，Channel是具体传输信息的通道抽象。一个Connection可以有多个Channel，每个Channel用于传输特定类型的数据或消息。
6. **接收链的TAO模块**根据验证后的数据包执行相应的操作。

## **ZK 跨链通信协议**

通过验证源链区块头，用户可以直接在目标链上访问源链证明并自行验证证明。所以降低了成本。**轻客户端**通常需要在接收链上运行，以验证从源链接收到的数据包。这需要计算资源和存储。

ZK跨链通信协议步骤：

- 决定将哪些数据传递给目标链
- 获取存储证明（证明数据存在 EVM 存储中）
- 根据存储证明生成 ZK 证明（以 Merkle Tree 的形式）
- 将 ZK 证明从起始链传递到目标链（中继 ZKP）
- 在目标链上展开 ZK 证明（链上积累、链上压缩、链下压缩）
    
    链上积累：将多个数据块或交易信息积累成一个综合的证明，以便在目标链上进行有效的验证。
    
- 在目标链读取跨链信息

## Layer Zero

LayerZero的架构主要包含**端点，中继节点和预言机**。

LayerZero 将**获取必要的跨链区块头和交易证明**的任务委托给线下的中继节点和预言机。

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a6ca9822-e902-41f9-90d9-747f9ae75db0/bb097be0-24f7-496e-8275-863e700673b8/image.png)

- 步骤1：用户应用程序UA（如 Stargate桥） LayerZero 的通信器（Communicator）发送请求，包括交易标识符t、从 A 到 B 转移的数据（payload有效负载）、或指向 Chain B 上用户应用程序智能合约的标识符或者中继器(relayer_args)等交易信息。
- 步骤2：通信器将这些数据以 LayerZero 数据包（packet）的形式发送给验证器（Validator）
- 步骤3：验证器将交易标识符和链 B 上智能合约的标识符等发送给网络层（NetWork）。网络层的工作也被触发，有待传递的信息需要通过oracle将源链A的区块头发送到目标链B。
- 步骤4：验证器将此信息（packet）转发给中继器。中继器被通知后则取交易证明（第7步的Proof）链下存储，并将其发送到Chain B（第11步），chainB的端点亦可发起申请要求获取指定块哈希的结果(第10步)。
- 步骤5：网络层将Chain B上智能合约的标识符和交易块的块ID一起发送给预言机。当预言机被通知则获取Chain A上当前块的块头（第6步）并将其发送到Chain B（第8步）。

可以看到这时候其实6、7、8、10、11的部分都内嵌在中继器和预言机的环节执行了。

- 步骤9：网络层将获取到的区块哈希发送到验证器（触发超轻节点的验证）。
- 步骤12：验证器通过查看网络层存储的交易证明和块头来确保交易有效且已提交。如果块头和交易证明匹配，则将交易信息（Packet）发送到通信器。
- 步骤13：通信器将信息（Packet）转发送到Chain B上的用户应用程序中，执行任意功能。

**整体跨链交易的费用结构**:

- 在源链上，用户支付的费用通常是一次性的，这笔费用用来执行源链上的交易操作。
- 在目标链上，费用用来执行目标链上的数据传输、数据验证和协议执行。这些费用通常费用是分给三个部分，中继器、预言机和Layer Zero协议Executor 。

Layer Zero协议Executor: Executor 负责在目标链上执行验证和数据传输。

Executor（通常是一个外部拥有账户EOA）

# 跨链技术

目前主流的区块链跨链技术方案按照其具体的实现方式主要有：公证人机制、哈希锁定、侧链&中继链、分布式私钥控制。

### 公证人机制

公证人机制通过引入第三方来验证交易信息是否一致、合法,无需对交易的细节进行验证。

公证人机制主要包括三种类型：**单签公证人、多重签名公证人、分布式签名公证人**。

### 哈希锁定

哈希锁定机制又称为哈希时间锁定协议（hashed- timelock agreements, HTLA），是一种基于原子交换的跨链机制

哈希锁定机制只支持资产或者信息交换，而不支持资产或者信息转移。

例子

1. Alice随机构建一个字符串s，并计算出其哈希h；
2. Alice将h发送给Bob；
3. Alice通过合约锁定自己的1个BTC资产，设置一个较长的锁定时间T1, 再设置了获取该BTC的条件：Bob提供h的原始值s;
4. Bob锁定50ETH到自己的合约，设置一个相对较短的锁定时间T2(T2 < T1)。再设置50ETH的获取条件：Alice提供h的原始值s；
5. Alice将字符串s发送到Bob的合约获得50个ETH;
6. Bob观察到步骤5中Alice的s值，将其发送给Alice的合约成功获取1个BTC; 至此完成资产的交换。
7. 如果超时，则锁定的资产返回原主。

### 2024.09.02
To be continued.. Begin Uniswap learning

### 2024.09.03
To be continued.. Begin Uniswap learning


<!-- Content_END -->
